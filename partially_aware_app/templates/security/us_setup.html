{% extends "security/_base.html" %}
{% from "security/_macros.html" import render_field_with_errors, render_field, render_field_errors %}

{% block content %}
{% include "security/_messages.html" %}

<div class="flex justify-center pt-12 px-4">
	<div class="w-full max-w-lg bg-white rounded shadow-md overflow-hidden">
		<div class="px-6 py-6">
			<h1 class="text-2xl font-semibold text-gray-900 mb-4">{{ _fsdomain("Setup Unified Sign In options") }}</h1>

			<form action="{{ url_for_security("us_setup") }}" method="POST" name="us_setup_form" class="space-y-4">
				{{ us_setup_form.hidden_tag() }}

				{% if setup_methods %}
					<p class="text-gray-700 mb-2">
						Currently Active options:
						{% if active_methods %}
							{{ ", ".join(active_methods) }}
						{% else %}
							None.
						{% endif %}
					</p>

					{% for subfield in us_setup_form.chosen_method %}
						{% if subfield.data in available_methods %}
							{{ render_field_with_errors(subfield, class_='mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500') }}
						{% endif %}
					{% endfor %}

					{{ render_field_errors(us_setup_form.chosen_method) }}

					{% if "sms" in available_methods %}
						{{ render_field_with_errors(us_setup_form.phone, class_='mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500') }}
					{% endif %}

					{% if code_sent %}
						<div class="font-semibold text-lg text-gray-800">{{ _fsdomain("Code has been sent") }}</div>
					{% endif %}

					<div>
						{{ render_field(us_setup_form.submit, class_='w-full bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500') }}
					</div>

					{% if chosen_method == "authenticator" %}
						<hr class="my-4">
						<div class="text-center space-y-4">
							<div class="text-gray-700">
								{{ _fsdomain("Open an authenticator app on your device and scan the following QRcode (or enter the code below manually) to start receiving passcodes:") }}
							</div>
							<div>
								<img alt="{{ _fsdomain("Passwordless QRCode") }}" id="qrcode" src="{{ authr_qrcode }}" class="mx-auto">
							</div>
							<div class="font-mono text-gray-800">
								{{ authr_key }}
							</div>
						</div>
					{% endif %}
				{% else %}
					<h3 class="text-gray-700">{{ _fsdomain("No methods have been enabled - nothing to setup") }}</h3>
				{% endif %}
			</form>

			{% if state %}
				<hr class="my-6">
				<form action="{{ url_for_security("us_setup_validate", token=state) }}" method="POST" name="us_setup_validate_form" class="space-y-4">
					{{ us_setup_validate_form.hidden_tag() }}
					{{ render_field_with_errors(us_setup_validate_form.passcode, class_='mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500') }}
					<div>
						{{ render_field(us_setup_validate_form.submit, class_='w-full bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500') }}
					</div>
				</form>
			{% endif %}
		</div>
	</div>
</div>
{% endblock %}
